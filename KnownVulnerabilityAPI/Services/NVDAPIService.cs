using KnownVulnerabilityAPI.Models;

namespace KnownVulnerabilityAPI.Services
{
    public interface INVDAPIService
    {
        public Task<CPEResult?> QueryCPE(string query);
        public Task<CVEResult?> QueryCVE(string cpe);
    }
    public class NVDAPIService(IHttpClientFactory httpClientFactory) : INVDAPIService
    {

        private readonly HttpClient _client = httpClientFactory.CreateClient();
        private readonly string _cpeBaseUri = "https://services.nvd.nist.gov/rest/json/cpes/2.0";
        private readonly string _cveBaseUri = "https://services.nvd.nist.gov/rest/json/cves/2.0";

        public async Task<CPEResult?> QueryCPE(string query) => await _client.GetFromJsonAsync<CPEResult>($"{_cpeBaseUri}?keywordSearch={query}");
        public async Task<CVEResult?> QueryCVE(string cpe) => await _client.GetFromJsonAsync<CVEResult>($"{_cveBaseUri}?cpeName={cpe}");
    }
}
