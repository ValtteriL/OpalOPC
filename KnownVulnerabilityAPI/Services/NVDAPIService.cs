namespace KnownVulnerabilityAPI.Services
{
    public interface INVDAPIService
    {
        public Task<CPEResult?> QueryCPE(string query);
        public Task<CVEResult?> QueryCVE(string cpe);
    }
    public class NVDAPIService : INVDAPIService
    {

        private readonly HttpClient _client;
        private readonly string _cpeBaseUri = "https://services.nvd.nist.gov/rest/json/cpes/2.0";
        private readonly string _cveBaseUri = "https://services.nvd.nist.gov/rest/json/cves/2.0";

        public NVDAPIService(IConfiguration configuration)
        {
            _client = new HttpClient()
            {
                // settings here (if needed)
            };

            _client.DefaultRequestHeaders.Add("apiKey", configuration["ApiKey"]);
        }

        public async Task<CPEResult?> QueryCPE(string query) => await _client.GetFromJsonAsync<CPEResult>($"{_cpeBaseUri}?keywordSearch={query}");
        public async Task<CVEResult?> QueryCVE(string cpe) => await _client.GetFromJsonAsync<CVEResult>($"{_cveBaseUri}?cpeName={cpe}");
    }
}
