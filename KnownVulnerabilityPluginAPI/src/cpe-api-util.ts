import { requireOkOrThrow } from './api-common'
import { type Env, type CPEResult } from './types'

type PromiseRejection = never

const baseUri = 'https://services.nvd.nist.gov/rest/json/cpes/2.0'

export const getCPEDetails = async (
  query: string, env: Env
): Promise<CPEResult | PromiseRejection> =>
  await fetch(`${baseUri}?keywordSearch=${query}`, {
    headers: {
      'content-type': 'application/json;charset=UTF-8',
      apiKey: env.API_KEY
    }
  })
    .then(requireOkOrThrow)
    .then(async (response: Response) => await response.json())
