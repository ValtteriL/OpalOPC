import { createFetchConfig } from './api-common'
import { type Env, type CPEResult } from './types'

type PromiseRejection = never

const baseUri = 'https://services.nvd.nist.gov/rest/json/cpes/2.0'

export const getCPEDetails = async (
  query: string, env: Env
): Promise<CPEResult | PromiseRejection> =>
  await fetch(`${baseUri}?keywordSearch=${query}`, createFetchConfig(env))
    .then(async (response: Response): CPEResult => {
      if (!response.ok) {
        return await Promise.reject(response.statusText)
      }

      return await response.json()
    })
    .then((data: CPEResult) => data)
