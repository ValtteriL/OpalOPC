import { requireOkOrThrow } from './api-common'
import { type Env, type CVEResult } from './types'

type PromiseRejection = never

const baseUri = 'https://services.nvd.nist.gov/rest/json/cves/2.0'

export const getCVEsForCPE = async (cpe: string, env: Env): Promise<CVEResult | PromiseRejection> =>
	await fetch(`${baseUri}?cpeName=${cpe}`, {
		headers: {
			'content-type': 'application/json;charset=UTF-8',
			apiKey: env.API_KEY
		}
	})
		.then(requireOkOrThrow)
		.then(async (response: Response) => await response.json())
