import { createFetchConfig } from './api-common'
import { type Env, type CVEResult } from './types'

type PromiseRejection = never

const baseUri = 'https://services.nvd.nist.gov/rest/json/cves/2.0'

export const getCVEsForCPE = async (cpe: string, env: Env): Promise<CVEResult | PromiseRejection> =>
  await fetch(`${baseUri}?cpeName=${cpe}`, createFetchConfig(env))
    .then(async (response: Response) => {
      if (!response.ok) {
        return await Promise.reject(response.statusText)
      }

      return await response.json()
    })
    .then((data: CVEResult) => data)
